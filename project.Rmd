---
title: "Final project"
author: "Your name goes here"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    highlight: zenburn
    number_sections: yes
    toc: yes
    toc_float: yes
    code_folding: show
---

```{r, setup, echo=FALSE}
knitr::opts_chunk$set(
  message = FALSE, 
  warning = FALSE, 
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code
options(digits = 3)

# default figure size
knitr::opts_chunk$set(
  fig.width=6.75, 
  fig.height=6.75,
  fig.align = "center"
)
```

```{r load-libraries, warning=FALSE, message=FALSE, echo=FALSE}
library(tidyverse)  # Load ggplot2, dplyr, and all the other tidyverse packages
library(mosaic)
library(ggthemes)
library(lubridate)
library(here)
library(skimr)
library(janitor)
library(vroom)
library(tidyquant)
library(spotifyr)
library(lubridate)

```

```{r}
#loading data and fixing column names using janitor
spotify_data <- vroom("data/spotify.csv", show_col_types = FALSE) %>% 
  clean_names()

glimpse(spotify_data)
```

```{r}
summary(spotify_data)
```


```{r}
#check NA values for the release date
sum(is.na(spotify_data$`Release Date`))
```

```{r}
#clean data
spotify_data_clean <- spotify_data %>%
  dplyr::select(-index) %>%  #remove index column
  dplyr::select(-artist_followers,-streams, -song_id, everything()) %>%#move some not-so-important variables to the end. 
  mutate(
    release_date = mdy(release_date)#convert release date from char to date format
  ) %>%
  filter(!is.na(release_date))#17 values had a different format than month-day-year. We remove these and the previous NA values.

glimpse(spotify_data_clean)
```

```{r}
library(spotifyr)
id <- "5e8d4482013047a08a112938acdf2bb5"
secret <- "ecf72954cdd54588b37fc9ad99be669b"
Sys.setenv(SPOTIFY_CLIENT_ID = id)
Sys.setenv(SPOTIFY_CLIENT_SECRET = secret)
access_token <- get_spotify_access_token()


beatles <- get_track_("3Wrjm47oTz2sjIgck11l5e")
beatles
```


#dump
```{r}
billboard_data <- billboard_data %>%
  mutate(
    chart_year = year(chart_date)
  )
```

```{r}
different_songs <- billboard_data %>%
  distinct(performer, chart_year) %>%
  group_by(chart_year) %>%
  mutate(count = n()) %>%
  distinct(chart_year, count) %>%
  arrange(chart_year)

glimpse(different_songs)

ggplot(data = different_songs) +
  geom_col() +
  aes(x = chart_year, y = count) +
  labs(x = 'Year',
       y = "# different artists", 
       title = "Number of different artists featured each year")
  
```


```{r}
different_songs <- billboard_data %>%
  distinct(performer)
  group_by(chart_year) %>%
  count(song) %>%
  distinct(chart_year, n)

glimpse(different_songs)
```
